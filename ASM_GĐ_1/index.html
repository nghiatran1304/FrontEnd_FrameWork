<!DOCTYPE html>
<html lang="en">

<head>
    <title>ASM - PS14820</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/all.min.css" />
    <link rel="stylesheet" href="css/bai5_moi.css" />
    <script src="angularJS/angular.min.js"></script>
    <script src="angularJS/angular-route-1-8-2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angularFire/2.3.0/angularfire.min.js"
        integrity="sha512-8ZDKhABrbEX/eIybbe5W4gM3qP6ABDDHrb9c/+HoqI6jT3vDIxmNSlEsw1DBd/J/dmLDs5Ueg2WWYLqpq0/U8A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://apis.google.com/js/platform.js?onload=onLoadCallback" async defer></script>
    <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>
    <style>
        article {
            min-height: 1000px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 160px;
            z-index: 1;
        }

        .dropdown-content a {
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dr:hover .dropdown-content {
            display: block;
        }
    </style>
</head>

<body ng-app="myApp" ng-controller="myCtrl">
    <div ng-include=" 'indexHeader.html' "></div>
    <!-- -------------------- -->

    <div ng-include=" 'indexMenu.html' "></div>

    <!-- -------------------- -->

    <article id="content" class="">
        <div class="mt-5 p-2" ng-view></div>
    </article>

    <!-- -------------------- -->
    <!-- <div ng-include=" 'indexFooter.html' "> -->
    <div>
        <footer class="dk-footer container-fluid mt-5" id="dk-footer">
            <div class="row container-fluid">
                <div class="col-12 col-lg-4">
                    <div class="container-fluid p-5 dk-footer-box-info mb-4">
                        <div class="pr-5 text-center">
                            <a href="#" class="footer-logo text-center col">
                                <img src="image/logo_1.png" alt="footer_logo" width="250" height="150"
                                    class="img-fluid ml-5 pl-5" />
                            </a>
                        </div>
                        <h4 class="footer-info-text text-light text-center col">
                            Tập đoàn GodEdoc hân hạnh tài trợ
                        </h4>
                        <div class="footer-social-link mb-2 text-center">
                            <ul>
                                <li>
                                    <a href="#">
                                        <i class="fab fa-facebook-f bg-primary"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="fab fa-twitter"></i> </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fab fa-google-plus-g text-danger bg-light"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="fab fa-linkedin-in bg-primary"></i>
                                    </a>
                                </li>
                                <li>
                                    <a href="#"> <i class="fab fa-instagram"></i> </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- End Col -->
                <div class="col-12 col-lg-8">
                    <div class="row mb-5 mt-5">
                        <div class="col-12 col-md-5">
                            <div class="">
                                <div class="contact-info">
                                    <h3>
                                        <i class="fas fa-map-marked-alt text-light" aria-hidden="true"></i>
                                        Việt Nam
                                    </h3>
                                    <h6>Thành phố Hồ Chí Minh</h6>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-7">
                            <div class="">
                                <div class="contact-info">
                                    <h3>
                                        <i class="fas fa-phone-square text-light" aria-hidden="true"></i>
                                        0366 888 470
                                    </h3>
                                    <h6>Liên hệ với chúng tôi</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-lg-5">
                            <div class="footer-widget footer-left-widget">
                                <div class="section-heading">
                                    <h3>Useful Links</h3>
                                    <span class="animate-border border-black"></span>
                                </div>
                                <ul class="text-light">
                                    <li><a href="#">About us</a></li>
                                    <li><a href="#">Services</a></li>
                                    <li><a href="#">Projects</a></li>
                                    <li><a href="#">Our Team</a></li>
                                </ul>
                                <ul class="text-light">
                                    <li><a href="#">Contact us</a></li>
                                    <li><a href="#">Blog</a></li>
                                    <li><a href="#">Testimonials</a></li>
                                    <li><a href="#">Faq</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-12 col-lg-7">
                            <div class="footer-widget footer-left-widget">
                                <div class="section-heading">
                                    <h3>Subscribe</h3>
                                    <span class="animate-border border-black"></span>
                                </div>
                                <h6 class="text-light">
                                    Nhận thông báo những tin tức mới nhất
                                </h6>
                                <form class="mt-5">
                                    <div class="form-row">
                                        <div class="col dk-footer-form">
                                            <input type="email" class="form-control" placeholder="Email" />
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>


    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-firestore.js"></script>

    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCsqIv2NyJO8fZ4CIMivytWsyU59WemGq0",
            authDomain: "dbfire-3aa39.firebaseapp.com",
            projectId: "dbfire-3aa39",
            storageBucket: "dbfire-3aa39.appspot.com",
            messagingSenderId: "209977624672",
            appId: "1:209977624672:web:a173f9e2b9d0caa62d9b05",
            measurementId: "G-XH6S74BMDE",
        };
        // init
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <script>
        var app = angular.module("myApp", ["ngRoute"]);

        gapi.load('auth2', initSigninV2);

        function initSigninV2() {
            gapi.auth2.init({
                // client_id: '38103395762-a03gvbvshdtca3gkcu93hro5gajsr94e.apps.googleusercontent.com'
                client_id: "830102791057-uh6nd15bhc6laq6h21lkc1gfuu6tpdke.apps.googleusercontent.com"
            }).then(function (authInstance) {
                // now auth2 is fully initialized
            });
        }


        //--------------------------- CONFIG--------------------------------------
        app.config(function ($routeProvider) {
            $routeProvider
                .when("/gioithieu", {
                    templateUrl: "gioithieu.html",
                })
                .when("/lienhe", {
                    templateUrl: "lienhe.html",
                })
                .when("/gopy", {
                    templateUrl: "gopy.html",
                })
                .when("/hoidap", {
                    templateUrl: "hoidap.html",
                })
                .when("/dangnhap", {
                    templateUrl: "dangnhap.html",
                    controller: "loginCtrl",
                })
                .when("/dangky", {
                    templateUrl: "dangky.html",
                    controller: "registerCtrl",
                })
                .when("/quenmatkhau", {
                    templateUrl: "quenmatkhau.html",
                    controller: "forgotpasswordCtrl",
                })
                .when("/doimatkhau", {
                    templateUrl: "doimatkhau.html",
                    controller: "changepasswordCtrl",
                })
                .when("/suadoithongtin", {
                    templateUrl: "suadoithongtin.html",
                    controller: "updateaccountCtrl",
                })
                .when("/tracnghiem/:idMH/:tenMH", {
                    templateUrl: "tracnghiem.html",
                    controller: "tnctrl",
                })
                .when("/trangchu", {
                    templateUrl: "trangchu.html",
                })
                .otherwise({
                    templateUrl: "dangnhap.html",
                });
        });

        // -------------------- INIT RUN----------------------------------
        app.run(function ($rootScope, $http) {

            $http.get("db/Students.js").then(function (response) {
                $rootScope.students = response.data;
            });

            $http.get("db/Subjects.js").then(function (response) {
                $rootScope.subjects = response.data;
            });

            $rootScope.student = null;
            // $rootScope.student == {};
            $rootScope.indexStudent = -1;
            window.location.href = "#!dangnhap";
        });

        // -------------------------------------------- MY CTRL------------------------------------
        app.controller("myCtrl", function ($scope, $rootScope, $http) {




            $scope.cacmonhoc = [];
            $http.get("db/Subjects.js").then(function (d) {
                $scope.cacmonhoc = d.data;
            });

            $scope.pageSize = 6;
            $scope.start = 0;

            $scope.first = function () {
                $scope.start = 0;
            };

            $scope.last = function () {
                $scope.start =
                    (Math.ceil($scope.cacmonhoc.length / $scope.pageSize) - 1) *
                    $scope.pageSize;
            };

            $scope.sortBy = function (cond) {
                $scope.sx = cond;
            };

            $scope.next = function () {
                if ($scope.start < $scope.cacmonhoc.length - $scope.pageSize) {
                    $scope.start += $scope.pageSize;
                }
            };

            $scope.prev = function () {
                if ($scope.start > 0) {
                    $scope.start -= $scope.pageSize;
                }
            };
            $rootScope.student = {};
            $rootScope.logoff = function () {
                $rootScope.student = null;
                $rootScope.indexStudent = -1;

                window.location.href = "#!dangnhap";

                var a = document.getElementById("dangnhapTrangChu");
                a.setAttribute("href", "#!dangnhap");
                document.getElementById("dangnhap").style.visibility = "visible";
                document.getElementById("dangnhap").innerHTML =
                    '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
                var a = document.getElementById("dangnhap");
                a.setAttribute("href", "#!dangnhap");

                var b = document.getElementById("doiMatKhau");
                b.setAttribute("href", "#!dangnhap");

                var c = document.getElementById("suadoithongtin");
                c.setAttribute("href", "#!dangnhap");
            };

            $rootScope.kiemtraDangNhap = function () {
                if ($rootScope.student == null) {
                    alert("Vui lòng đăng nhập để tiếp tục !");

                    window.location.href = "#!dangnhap";
                } else {
                    window.location.href = "#!suadoithongtin";
                }
            };

            $rootScope.kiemTraDangNhapDoiMatKhau = function () {
                if ($rootScope.student == null) {
                    alert("Vui lòng đăng nhập để tiếp tục !");
                    window.location.href = "#!dangnhap";
                } else {
                    window.location.href = "#!doimatkhau";
                }
            };
        });

        //------------------------------------ LOGIN ---------------------------------------
        app.controller("loginCtrl", function ($scope, $rootScope) {
            $scope.login = function () {
                var ig = true;
                $rootScope.students.forEach((st) => {
                    if (st.username == $scope.username) {
                        if (st.password == $scope.password) {
                            for (var i = 0; i < $rootScope.students.length; i++) {
                                if ($rootScope.students[i].username == st.username) {
                                    $rootScope.indexStudent = i;
                                }
                            }
                            $rootScope.student = st;
                            window.location.href = "#!trangchu";
                            var a = document.getElementById("dangnhapTrangChu");
                            a.setAttribute("href", "#!trangchu");
                            // document.getElementById("dangnhap").style.visibility = "hidden";
                            document.getElementById("dangnhap").innerHTML =
                                $rootScope.student.username;
                            var a = document.getElementById("dangnhap");
                            a.setAttribute("href", "#!suadoithongtin");

                            var b = document.getElementById("doiMatKhau");
                            b.setAttribute("href", "#!doimatkhau");

                            var c = document.getElementById("suadoithongtin");
                            c.setAttribute("href", "#!suadoithongtin");
                            ig = false;

                            Swal.fire({
                                position: "top-end",
                                icon: "success",
                                title: "Đăng nhập thành công !",
                                showConfirmButton: false,
                                timer: 1200,
                            });
                            return;
                        }
                    }
                });

            
                if (ig == true) {
                    $rootScope.student = null;
                    Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        html: '<h2 class="text-danger"> Sai tài khoản hoặc mật khẩu rồi bạn eii ! </h2>',
                        width: 750,
                        padding: "3em",
                        background: "#fff url(https://sweetalert2.github.io/images/trees.png)",
                        backdrop: `
                            rgba(0,0,123,0.4)
                            url("https://sweetalert2.github.io/images/nyan-cat.gif")
                            left top
                            no-repeat
                        `,
                    });
                }
            };
        });

        // ------------------------------Register----------------------------------------------
        app.controller("registerCtrl", function ($rootScope, $scope) {
            $scope.register = function () {
                var isExsist = false;
                $scope.studentR = {};
                if (
                    $scope.studentR.fullname == null ||
                    $scope.studentR.username == null ||
                    $scope.studentR.password == null ||
                    $scope.studentR.email == null ||
                    $scope.studentR.birthday == null
                ) {
                    Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        text: "Đăng kí thất bại!",
                    });
                } else {
                    for (var i = 0; i < $rootScope.students.length; i++) {
                        if ($scope.studentR.username == $rootScope.students[i].username) {
                            isExsist = true;
                            break;
                        }
                    }
                    if (!isExsist) {
                        $rootScope.students.push(angular.copy($scope.studentR));
                        $scope.studentR = {};
                        Swal.fire({
                            icon: "success",
                            title: "NICE !",
                            text: "Đăng kí thành công !",
                        });
                    } else {
                        Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Tài khoản đã tồn tại ! ",
                        });
                    }
                }
            };
        });

        //-------------------------------ChangePassword----------------------------------------
        app.controller("changepasswordCtrl", function ($rootScope, $scope) {
            $scope.change = function () {
                if ($rootScope.student != null) {
                    if ($rootScope.student.password == $scope.studentR.password) {
                        $rootScope.student.password = $scope.newPassword;

                        $rootScope.students[$rootScope.indexStudent] = angular.copy(
                            $rootScope.student
                        );
                        Swal.fire({
                            icon: "success",
                            title: "NICE !",
                            text: "Đổi mật khẩu thành công !",
                        });

                        $rootScope.student = null;
                        $rootScope.indexStudent = -1;
                        window.location.href = "#!dangnhap";
                    } else {
                        Swal.fire({
                            icon: "error",
                            title: "Oops...",
                            text: "Đổi mật khẩu thất bại ! ",
                        });
                    }
                } else {
                    Swal.fire({
                        title: "Lỗi !!!!",
                        text: "Vui lòng đăng nhập",
                        icon: "warning",
                        confirmButtonColor: "#3085d6",
                    });
                }
            };
        });
        //-------------------------------ForgotPassword------------------------------------------
        app.controller("forgotpasswordCtrl", function ($rootScope, $scope) {
            $scope.getPass = function () {
                var ck = true;
                $rootScope.students.forEach((st) => {
                    if (st.email == $scope.email && st.username == $scope.username) {
                        alert("Mật khẩu : " + st.password);
                        ck = false;
                        return;
                    }
                });
                if (ck) {
                    alert("Thất bại !");
                }
            };
        });

        //--------------------------------EditProfile------------------------------------------
        app.controller("updateaccountCtrl", function ($rootScope, $scope) {
            $scope.update = function () {
                $rootScope.students[$rootScope.indexStudent] = angular.copy(
                    $rootScope.student
                );
                alert("Cập nhật thành công !");
            };
        });

        // ---------------------------------EXAM-----------------------------------------------
        app.controller("tnctrl", function ($scope, $http, $routeParams) {
            $scope.caccauhoi = [];
            $scope.idMH = $routeParams.idMH;
            $scope.tenMH = $routeParams.tenMH;
            $scope.soCauHoi = 0;
            $scope.random10CauHoi = [];
            $scope.mangIdCauHoi = [];
            $http.get("db/Quizs/" + $scope.idMH + ".js").then(
                function (d) {
                    $scope.caccauhoi = d.data;
                    $scope.soCauHoi = $scope.caccauhoi.length - 1;
                    for (let i = 0; i < 10; i++) {
                        var rand = Math.floor(Math.random() * $scope.soCauHoi);
                        $scope.random10CauHoi[i] = angular.copy($scope.caccauhoi[rand]);
                        $scope.mangIdCauHoi[i] = angular.copy(rand);
                    }
                },
                function (e) {
                    alert("Lỗi : " + e.statusText);
                }
            );

            $scope.pageSize = 1;
            $scope.start = 0;

            $scope.first = function () {
                $scope.start = 0;
            };

            $scope.last = function () {
                $scope.start =
                    (Math.ceil($scope.random10CauHoi.length / $scope.pageSize) - 1) *
                    $scope.pageSize;
            };

            // ----------------------------------- Lấy câu trả lời từ người dùng
            $scope.userChoose = "";
            $scope.diem = $scope.student.marks;
            var luuCauTraLoi = ["n", "n", "n", "n", "n", "n", "n", "n", "n", "n"];
            var danhSach10CauHoi = [];

            $scope.diem = 0;
            $scope.viTriCauHoi = [];
            $scope.cauTraLoi = [];

            $scope.ans = function (cauTraLoi) {
                console.log(cauTraLoi);
                $scope.userChoose = cauTraLoi;
                luuCauTraLoi[$scope.start] = $scope.userChoose;
                return cauTraLoi;
            };

            $scope.next = function () {
                if ($scope.start < $scope.random10CauHoi.length - $scope.pageSize) {
                    danhSach10CauHoi[$scope.start] =
                        $scope.random10CauHoi[$scope.start];
                    for (var a = 0; a < 4; a++) {
                        if (
                            $scope.random10CauHoi[$scope.start].Answers[a].Id ==
                            luuCauTraLoi[$scope.start]
                        ) {
                            document.getElementById(
                                $scope.random10CauHoi[$scope.start].Answers[a].Id
                            ).checked = true;
                            break;
                        }
                    }
                    $scope.start += $scope.pageSize;
                }
            };

            $scope.prev = function () {
                if ($scope.start > 0) {
                    for (var a = 0; a < 4; a++) {
                        if (
                            $scope.random10CauHoi[$scope.start].Answers[a].Id ==
                            luuCauTraLoi[$scope.start]
                        ) {
                            document.getElementById(
                                $scope.random10CauHoi[$scope.start].Answers[a].Id
                            ).checked = true;
                            break;
                        }
                    }
                    $scope.start -= $scope.pageSize;
                }
            };

            $scope.ketThucKiemTra = function () {
                var ketQua = "";
                for (var i = 0; i < luuCauTraLoi.length; i++) {
                    console.log(
                        $scope.random10CauHoi[i].Id +
                        "AnswerID : " +
                        $scope.random10CauHoi[i].AnswerId
                    );
                    console.log("User choose : " + luuCauTraLoi[i]);

                    var cauTraLoi = "";
                    var cauTraLoiNguoiChon = "";
                    for (var a = 0; a < 4; a++) {
                        if (
                            $scope.random10CauHoi[i].AnswerId ==
                            $scope.random10CauHoi[$scope.start].Answers[a].Id
                        ) {
                            cauTraLoi = $scope.random10CauHoi[$scope.start].Answers[a].Text;
                            if (
                                luuCauTraLoi[i] ==
                                $scope.random10CauHoi[$scope.start].Answers[a].Id
                            ) {
                                cauTraLoiNguoiChon =
                                    $scope.random10CauHoi[$scope.start].Answers[a].Text;
                            }
                        }
                    }

                    ketQua +=
                        $scope.random10CauHoi[i].Text +
                        " - Đáp án : " +
                        cauTraLoi +
                        "\n" +
                        "Bạn chọn : " +
                        cauTraLoiNguoiChon +
                        "\n";

                    if ($scope.random10CauHoi[i].AnswerId == luuCauTraLoi[i]) {
                        $scope.diem += 1;
                    }
                }
                console.log(ketQua);
                Swal.fire({
                    icon: "success",
                    title: "Kết thúc kiểm tra",
                    text: "Điểm của bạn là : " + $scope.diem,
                });
            };
        });
    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
        integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous">
    </script>

    <!-- <script>
        window.onscroll = function () {
            myFunction();
        };

        var header = document.getElementById("myHeader");
        var sticky = header.offsetTop;

        function myFunction() {
            if (window.pageYOffset > sticky) {
                header.classList.add("sticky");
            } else {
                header.classList.remove("sticky");
            }
        }
    </script> -->
</body>

</html>