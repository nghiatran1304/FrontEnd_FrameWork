<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ASM - PS14820</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <script src="https://apis.google.com/js/platform.js?onload=onLoadCallback" async defer></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous" />
    <link rel="stylesheet" href="css/all.min.css" />
    <link rel="stylesheet" href="css/bai5_moi.css" />
    <script src="angularJS/angular.min.js"></script>
    <script src="angularJS/angular-route-1-8-2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angularFire/2.3.0/angularfire.min.js" integrity="sha512-8ZDKhABrbEX/eIybbe5W4gM3qP6ABDDHrb9c/+HoqI6jT3vDIxmNSlEsw1DBd/J/dmLDs5Ueg2WWYLqpq0/U8A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://apis.google.com/js/platform.js?onload=onLoadCallback" async defer></script>
    <!-- <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script> -->
    <meta name="google-signin-client_id" content="830102791057-uh6nd15bhc6laq6h21lkc1gfuu6tpdke.apps.googleusercontent.com" />

    <style>
      article {
        min-height: 1000px;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f1f1f1;
        min-width: 160px;
        z-index: 199;
      }

      .dropdown-content a {
        padding: 12px 16px;
        text-decoration: none;
        display: block;
      }

      .dr:hover .dropdown-content {
        display: block;
      }
    </style>
  </head>

  <body ng-app="myApp" ng-controller="myCtrl">
    <div ng-include=" 'indexHeader.html' "></div>
    <!-- -------------------- -->

    <div ng-include=" 'indexMenu.html' "></div>

    <!-- -------------------- -->

    <article id="content" class="">
      <div class="mt-5 p-2" ng-view></div>
    </article>

    <!-- -------------------- -->
    <!-- <div ng-include=" 'indexFooter.html' "> -->
    <div>
      <footer class="dk-footer container-fluid mt-5" id="dk-footer">
        <div class="row container-fluid">
          <div class="col-12 col-lg-4">
            <div class="container-fluid p-5 dk-footer-box-info mb-4">
              <div class="pr-5 text-center">
                <a href="#" class="footer-logo text-center col">
                  <img src="image/logo_1.png" alt="footer_logo" width="250" height="150" class="img-fluid ml-5 pl-5" />
                </a>
              </div>
              <h4 class="footer-info-text text-light text-center col">Tập đoàn GodEdoc hân hạnh tài trợ</h4>
              <div class="footer-social-link mb-2 text-center">
                <ul>
                  <li>
                    <a href="#">
                      <i class="fab fa-facebook-f bg-primary"></i>
                    </a>
                  </li>
                  <li>
                    <a href="#"> <i class="fab fa-twitter"></i> </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fab fa-google-plus-g text-danger bg-light"></i>
                    </a>
                  </li>
                  <li>
                    <a href="#">
                      <i class="fab fa-linkedin-in bg-primary"></i>
                    </a>
                  </li>
                  <li>
                    <a href="#"> <i class="fab fa-instagram"></i> </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <!-- End Col -->
          <div class="col-12 col-lg-8">
            <div class="row mb-5 mt-5">
              <div class="col-12 col-md-5">
                <div class="">
                  <div class="contact-info">
                    <h3>
                      <i class="fas fa-map-marked-alt text-light" aria-hidden="true"></i>
                      Việt Nam
                    </h3>
                    <h6>Thành phố Hồ Chí Minh</h6>
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-7">
                <div class="">
                  <div class="contact-info">
                    <h3>
                      <i class="fas fa-phone-square text-light" aria-hidden="true"></i>
                      0366 888 470
                    </h3>
                    <h6>Liên hệ với chúng tôi</h6>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 col-lg-5">
                <div class="footer-widget footer-left-widget">
                  <div class="section-heading">
                    <h3>Useful Links</h3>
                    <span class="animate-border border-black"></span>
                  </div>
                  <ul class="text-light">
                    <li><a href="#">About us</a></li>
                    <li><a href="#">Services</a></li>
                    <li><a href="#">Projects</a></li>
                    <li><a href="#">Our Team</a></li>
                  </ul>
                  <ul class="text-light">
                    <li><a href="#">Contact us</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">Testimonials</a></li>
                    <li><a href="#">Faq</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-md-12 col-lg-7">
                <div class="footer-widget footer-left-widget">
                  <div class="section-heading">
                    <h3>Subscribe</h3>
                    <span class="animate-border border-black"></span>
                  </div>
                  <h6 class="text-light">Nhận thông báo những tin tức mới nhất</h6>
                  <form class="mt-5">
                    <div class="form-row">
                      <div class="col dk-footer-form">
                        <input type="email" class="form-control" placeholder="Email" />
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.21.0/firebase-firestore.js"></script>
    <!-- send email -->
    <script src="https://smtpjs.com/v3/smtp.js"></script>

    <script>
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyCsqIv2NyJO8fZ4CIMivytWsyU59WemGq0",
        authDomain: "dbfire-3aa39.firebaseapp.com",
        projectId: "dbfire-3aa39",
        storageBucket: "dbfire-3aa39.appspot.com",
        messagingSenderId: "209977624672",
        appId: "1:209977624672:web:a173f9e2b9d0caa62d9b05",
        measurementId: "G-XH6S74BMDE",
      };
      // init
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      //---------------------------------------------------------
      var app = angular.module("myApp", ["ngRoute"]);

      //--------------------------- CONFIG--------------------------------------
      app.config(function ($routeProvider) {
        $routeProvider
          .when("/home", {
            templateUrl: "home.html",
          })
          .when("/gioithieu", {
            templateUrl: "gioithieu.html",
          })
          .when("/lienhe", {
            templateUrl: "lienhe.html",
          })
          .when("/gopy", {
            templateUrl: "gopy.html",
          })
          .when("/hoidap", {
            templateUrl: "hoidap.html",
          })
          .when("/dangnhap", {
            templateUrl: "dangnhap.html",
            controller: "loginCtrl",
          })
          .when("/dangky", {
            templateUrl: "dangky.html",
            controller: "registerCtrl",
          })
          .when("/quenmatkhau", {
            templateUrl: "quenmatkhau.html",
            controller: "forgotpasswordCtrl",
          })
          .when("/doimatkhau", {
            templateUrl: "doimatkhau.html",
            controller: "changepasswordCtrl",
          })
          .when("/suadoithongtin", {
            templateUrl: "suadoithongtin.html",
            controller: "updateaccountCtrl",
          })
          .when("/tracnghiem/:idMH/:tenMH", {
            templateUrl: "tracnghiem.html",
            controller: "tnctrl",
          })
          .when("/chiTiet/:idKetQuaKiemTra/:idMH", {
            templateUrl: "chiTiet.html",
            controller: "chiTietController",
          })
          .when("/ketqua", {
            templateUrl: "ketqua.html",
            controller: "ketquaController",
          })
          .when("/trangchu", {
            templateUrl: "trangchu.html",
          })
          .otherwise({
            // templateUrl: "home.html"
            redirectTo: "home.html",
          });
      });

      // -------------------- INIT RUN----------------------------------
      app.run(function ($rootScope, $http) {
        $http.get("db/Students.js").then(function (response) {
          $rootScope.students = response.data;
        });

        $http.get("db/Subjects.js").then(function (response) {
          $rootScope.subjects = response.data;
        });
        localStorage.clear();
        $rootScope.student = null;
        $rootScope.usernameHienTai = null;
        $rootScope.passwordHienTai = null;
        $rootScope.emailHienTai = null;
        $rootScope.fullnameHienTai = null;
        $rootScope.marksHienTai = null;
        $rootScope.genderHienTai = null;
        $rootScope.birthdayHienTai = null;
        $rootScope.schoolfeeHienTai = null;
        // $rootScope.student == {};
        $rootScope.indexStudent = -1;
        window.location.href = "#!home";

        if (currentUser != null) {
          $rootScope.logout = function () {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
              localStorage.clear();
            });
            Swal.fire({
              position: "top-end",
              icon: "success",
              title: "Bạn đã đăng xuất tài khoản!",
              heightAuto: true,
              width: 500,
              timer: 1000,
            }).then(function () {
              window.location.reload();
              window.location.href = "#!dangnhap";
            });
          };
        }
      });

      //----------------------------GAPI-----------------------------------------
      gapi.load("auth2", initSigninV2);

      function initSigninV2() {
        gapi.auth2
          .init({
            // client_id: '38103395762-a03gvbvshdtca3gkcu93hro5gajsr94e.apps.googleusercontent.com'
            client_id: "830102791057-uh6nd15bhc6laq6h21lkc1gfuu6tpdke.apps.googleusercontent.com",
          })
          .then(function (authInstance) {});
      }

      // var currentUser = localStorage.getItem("name");
      var currentUser = localStorage.getItem("fullnameHienTais");
      if (currentUser != null) {
        console.log("Dòng 305 - Load page : " + currentUser);
        window.location.href = "#!dangnhap";
      } else {
        console.log("Dòng 308  - Khi bắt đầu loadpage Nếu currentUser = null");
      }
      // ----------------------------------- MY CTRL------------------------------------
      app.controller("myCtrl", function ($scope, $rootScope, $http) {
        $rootScope.hienTaiNull = function () {
          $rootScope.usernameHienTai = null;
          $rootScope.passwordHienTai = null;
          $rootScope.emailHienTai = null;
          $rootScope.fullnameHienTai = null;
          $rootScope.marksHienTai = null;
          $rootScope.genderHienTai = null;
          $rootScope.birthdayHienTai = null;
          $rootScope.schoolfeeHienTai = null;
        };

        $scope.cacmonhoc = [];
        $http.get("db/Subjects.js").then(function (d) {
          $scope.cacmonhoc = d.data;
        });

        $scope.pageSize = 6;
        $scope.start = 0;

        $scope.first = function () {
          $scope.start = 0;
        };

        $scope.last = function () {
          $scope.start = (Math.ceil($scope.cacmonhoc.length / $scope.pageSize) - 1) * $scope.pageSize;
        };

        $scope.sortBy = function (cond) {
          $scope.sx = cond;
        };

        $scope.next = function () {
          if ($scope.start < $scope.cacmonhoc.length - $scope.pageSize) {
            $scope.start += $scope.pageSize;
          }
        };

        $scope.prev = function () {
          if ($scope.start > 0) {
            $scope.start -= $scope.pageSize;
          }
        };
        $rootScope.student = {};
        $rootScope.logoff = function () {
          $rootScope.student = null;
          $rootScope.indexStudent = -1;

          $rootScope.hienTaiNull();

          window.location.href = "#!dangnhap";

          var a = document.getElementById("dangnhapTrangChu");
          a.setAttribute("href", "#!dangnhap");
          document.getElementById("dangnhap").style.visibility = "visible";
          document.getElementById("dangnhap").innerHTML = '<i class="fas fa-sign-in-alt"></i> Đăng nhập';
          var a = document.getElementById("dangnhap");
          a.setAttribute("href", "#!dangnhap");

          var b = document.getElementById("doiMatKhau");
          b.setAttribute("href", "#!dangnhap");

          var c = document.getElementById("suadoithongtin");
          c.setAttribute("href", "#!dangnhap");

          var a1 = document.getElementById("hienKetQua");
          a1.setAttribute("href", "#!dangnhap");
          //-----------------------
          var auth2 = gapi.auth2.getAuthInstance();
          auth2.signOut().then(function () {
            localStorage.clear();
          });
          Swal.fire({
            position: "top-end",
            icon: "success",
            title: "Bạn đã đăng xuất tài khoản!",
            heightAuto: true,
            width: 500,
            timer: 1000,
          }).then(function () {
            window.location.reload();
            window.location.href = "#!dangnhap";
          });
        };

        $rootScope.kiemtraDangNhap = function () {
          if ($rootScope.student == null) {
            alert("Vui lòng đăng nhập để tiếp tục !");

            window.location.href = "#!dangnhap";
          } else {
            window.location.href = "#!suadoithongtin";
          }
        };

        $rootScope.kiemTraDangNhapDoiMatKhau = function () {
          if ($rootScope.student == null) {
            alert("Vui lòng đăng nhập để tiếp tục !");
            window.location.href = "#!dangnhap";
          } else {
            window.location.href = "#!doimatkhau";
          }
        };
      });

      //------------------------------------ LOGIN ---------------------------------------
      app.controller("loginCtrl", function ($scope, $rootScope) {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          localStorage.clear();
        });
        var emailinput;
        var passwordinput;
        $rootScope.dangNhapThanhCong = false;
        var tiepTucDangNhapFireBase = true;
        $scope.login = function () {
          $rootScope.students.forEach((st) => {
            if (st.username == $scope.username) {
              if (st.password == $scope.password) {
                for (var i = 0; i < $rootScope.students.length; i++) {
                  if ($rootScope.students[i].username == st.username) {
                    $rootScope.indexStudent = i;
                  }
                }
                $rootScope.student = st;
                window.location.href = "#!trangchu";
                var a = document.getElementById("dangnhapTrangChu");
                a.setAttribute("href", "#!trangchu");
                // document.getElementById("dangnhap").style.visibility = "hidden";
                document.getElementById("dangnhap").innerHTML = $rootScope.student.username;
                var a = document.getElementById("dangnhap");
                a.setAttribute("href", "#!suadoithongtin");

                var b = document.getElementById("doiMatKhau");
                b.setAttribute("href", "#!doimatkhau");

                var c = document.getElementById("suadoithongtin");
                c.setAttribute("href", "#!suadoithongtin");
                $rootScope.dangNhapThanhCong = true;
                console.log("Dòng 445 - Đăng nhập thành công JS index.html");
                tiepTucDangNhapFireBase = false;
                Swal.fire({
                  position: "top-end",
                  icon: "success",
                  title: "Đăng nhập thành công",
                  showConfirmButton: false,
                  timer: 1200,
                });
                return;
              }
            }
          });

          if (tiepTucDangNhapFireBase) {
            // const account = [];
            emailinput = document.querySelector("#username").value;
            passwordinput = document.querySelector("#password").value;
            // Lấy database từ bảng users, với điều kiện trường email == với email nhập vào
            if (emailinput.includes("@")) {
              db.collection("users")
                .where("email", "==", emailinput)
                .get()
                .then((snapshot) => {
                  // Kiểm tra dữ liệu tra về có hay không
                  if (snapshot.docs.length > 0) {
                    snapshot.docs.forEach((doc) => {
                      var i;
                      if (emailinput === doc.data().email) {
                        if (passwordinput === doc.data().password) {
                          localStorage.removeItem("idHienTai");
                          localStorage.setItem("idHienTai", doc.id);
                          localStorage.setItem("passwordHienTais", doc.data().password);
                          localStorage.setItem("usernameHienTais", doc.data().username);
                          localStorage.setItem("emailHienTais", doc.data().email);
                          localStorage.setItem("fullnameHienTais", doc.data().fullname);
                          localStorage.setItem("marksHienTais", doc.data().marks);
                          localStorage.setItem("genderHienTais", doc.data().gender);
                          localStorage.setItem("birthdayHienTais", doc.data().birthday);
                          localStorage.setItem("schoolfeeHienTais", doc.data().schoolfee);

                          window.location.href = "#!trangchu";
                          $rootScope.dangNhapThanhCong = true;
                          localStorage.setItem("dangNhapThanhCong", "OK");
                          var a = document.getElementById("dangnhapTrangChu");
                          a.setAttribute("href", "#!trangchu");
                          // document.getElementById("dangnhap").style.visibility = "hidden";
                          document.getElementById("dangnhap").innerHTML = emailinput;
                          var a = document.getElementById("dangnhap");
                          a.setAttribute("href", "#!suadoithongtin");

                          var b = document.getElementById("doiMatKhau");
                          b.setAttribute("href", "#!doimatkhau");

                          var c = document.getElementById("suadoithongtin");
                          c.setAttribute("href", "#!suadoithongtin");

                          var a1 = document.getElementById("hienKetQua");
                          a1.setAttribute("href", "#!ketqua");

                          localStorage.setItem("name", doc.data().email);
                          Swal.fire({
                            text: "Đăng nhập thành công !",
                            icon: "success",
                            confirmButtonColor: "#3085d6",
                          });
                        }
                      }
                    });
                  }
                  if ($rootScope.dangNhapThanhCong == false) {
                    Swal.fire({
                      icon: "error",
                      title: "Oops...",
                      html: '<h2 class="text-danger"> Sai tài khoản hoặc mật khẩu rồi bạn eii ! </h2>',
                      width: 750,
                      padding: "3em",
                      background: "#fff url(https://sweetalert2.github.io/images/trees.png)",
                      backdrop: `
                                                  rgba(0,0,123,0.4)
                                                  url("https://sweetalert2.github.io/images/nyan-cat.gif")
                                                  left top
                                                  no-repeat
                                              `,
                    });
                  }
                })
                .then(function () {
                  if (localStorage.getItem("dangNhapThanhCong") == "OK") {
                    $rootScope.student = {};
                    $rootScope.usernameHienTai = localStorage.getItem("usernameHienTais");
                    $rootScope.passwordHienTai = localStorage.getItem("passwordHienTais");
                    $rootScope.emailHienTai = localStorage.getItem("emailHienTais");
                    $rootScope.fullnameHienTai = localStorage.getItem("fullnameHienTais");
                    $rootScope.marksHienTai = localStorage.getItem("marksHienTais");
                    $rootScope.genderHienTai = localStorage.getItem("genderHienTais");
                    $rootScope.birthdayHienTai = localStorage.getItem("birthdayHienTais");
                    $rootScope.schoolfeeHienTai = localStorage.getItem("schoolfeeHienTais");

                    // clear
                    localStorage.removeItem("usernameHienTais");
                    localStorage.removeItem("passwordHienTais");
                    localStorage.removeItem("emailHienTais");
                    localStorage.removeItem("fullnameHienTais");
                    localStorage.removeItem("marksHienTais");
                    localStorage.removeItem("genderHienTais");
                    localStorage.removeItem("birthdayHienTais");
                    localStorage.removeItem("schoolfeeHienTais");
                    localStorage.removeItem("dangNhapThanhCong");

                    $rootScope.student = {
                      username: $rootScope.usernameHienTai,
                      password: $rootScope.passwordHienTai,
                      email: $rootScope.emailHienTai,
                      fullname: $rootScope.fullnameHienTai,
                      marks: $rootScope.marksHienTai,
                      gender: $rootScope.genderHienTai,
                      birthday: $rootScope.birthdayHienTai,
                      schoolfee: $rootScope.schoolfeeHienTai,
                    };

                    console.log("Dòng 563 : " + $rootScope.student.username);
                  }
                });
            } else {
              db.collection("users")
                .where("username", "==", emailinput)
                .get()
                .then((snapshot) => {
                  // Kiểm tra dữ liệu tra về có hay không
                  if (snapshot.docs.length > 0) {
                    snapshot.docs.forEach((doc) => {
                      // account.push(doc.data());
                      var i;
                      if (emailinput === doc.data().username) {
                        if (passwordinput === doc.data().password) {
                          localStorage.removeItem("idHienTai");
                          localStorage.setItem("idHienTai", doc.id);
                          window.location.href = "#!trangchu";
                          $rootScope.dangNhapThanhCong = true;
                          localStorage.setItem("dangNhapThanhCong", "OK");
                          localStorage.setItem("passwordHienTais", doc.data().password);
                          localStorage.setItem("usernameHienTais", doc.data().username);
                          localStorage.setItem("emailHienTais", doc.data().email);
                          localStorage.setItem("fullnameHienTais", doc.data().fullname);
                          localStorage.setItem("marksHienTais", doc.data().marks);
                          localStorage.setItem("genderHienTais", doc.data().gender);
                          localStorage.setItem("birthdayHienTais", doc.data().birthday);
                          localStorage.setItem("schoolfeeHienTais", doc.data().schoolfee);

                          var a = document.getElementById("dangnhapTrangChu");
                          a.setAttribute("href", "#!trangchu");
                          // document.getElementById("dangnhap").style.visibility = "hidden";
                          document.getElementById("dangnhap").innerHTML = emailinput;
                          var a = document.getElementById("dangnhap");
                          a.setAttribute("href", "#!suadoithongtin");

                          var b = document.getElementById("doiMatKhau");
                          b.setAttribute("href", "#!doimatkhau");

                          var c = document.getElementById("suadoithongtin");
                          c.setAttribute("href", "#!suadoithongtin");

                          var a1 = document.getElementById("hienKetQua");
                          a1.setAttribute("href", "#!ketqua");

                          localStorage.setItem("name", doc.data().email);
                          Swal.fire({
                            text: "Đăng nhập thành công",
                            icon: "success",
                            confirmButtonColor: "#3085d6",
                          });
                        }
                      }
                    });
                  }
                  if ($rootScope.dangNhapThanhCong == false) {
                    Swal.fire({
                      icon: "error",
                      title: "Oops...",
                      html: '<h2 class="text-danger"> Sai tài khoản hoặc mật khẩu rồi bạn eii ! </h2>',
                      width: 750,
                      padding: "3em",
                      background: "#fff url(https://sweetalert2.github.io/images/trees.png)",
                      backdrop: `
                                                  rgba(0,0,123,0.4)
                                                  url("https://sweetalert2.github.io/images/nyan-cat.gif")
                                                  left top
                                                  no-repeat
                                              `,
                    });
                  }
                })
                .then(function () {
                  if (localStorage.getItem("dangNhapThanhCong") == "OK") {
                    $rootScope.student = {};
                    $rootScope.usernameHienTai = localStorage.getItem("usernameHienTais");
                    $rootScope.passwordHienTai = localStorage.getItem("passwordHienTais");
                    $rootScope.emailHienTai = localStorage.getItem("emailHienTais");
                    $rootScope.fullnameHienTai = localStorage.getItem("fullnameHienTais");
                    $rootScope.marksHienTai = localStorage.getItem("marksHienTais");
                    $rootScope.genderHienTai = localStorage.getItem("genderHienTais");
                    $rootScope.birthdayHienTai = localStorage.getItem("birthdayHienTais");
                    $rootScope.schoolfeeHienTai = localStorage.getItem("schoolfeeHienTais");

                    // clear
                    localStorage.removeItem("usernameHienTais");
                    localStorage.removeItem("passwordHienTais");
                    localStorage.removeItem("emailHienTais");
                    localStorage.removeItem("fullnameHienTais");
                    localStorage.removeItem("marksHienTais");
                    localStorage.removeItem("genderHienTais");
                    localStorage.removeItem("birthdayHienTais");
                    localStorage.removeItem("schoolfeeHienTais");
                    localStorage.removeItem("dangNhapThanhCong");

                    $rootScope.student = {
                      username: $rootScope.usernameHienTai,
                      password: $rootScope.passwordHienTai,
                      email: $rootScope.emailHienTai,
                      fullname: $rootScope.fullnameHienTai,
                      marks: $rootScope.marksHienTai,
                      gender: $rootScope.genderHienTai,
                      birthday: $rootScope.birthdayHienTai,
                      schoolfee: $rootScope.schoolfeeHienTai,
                    };
                  }
                });
            }
          }
          if ($rootScope.dangNhapThanhCong == false && tiepTucDangNhapFireBase == false) {
            $rootScope.student = null;
            Swal.fire({
              icon: "error",
              title: "Oops...",
              html: '<h2 class="text-danger"> Sai tài khoản hoặc mật khẩu rồi bạn eii ! </h2>',
              width: 750,
              padding: "3em",
              background: "#fff url(https://sweetalert2.github.io/images/trees.png)",
              backdrop: `
                                  rgba(0,0,123,0.4)
                                  url("https://sweetalert2.github.io/images/nyan-cat.gif")
                                  left top
                                  no-repeat
                              `,
            });
          }
        };

        gapi.load("auth2", function () {
          // Loads the auth2 component of gapi
          gapi.auth2
            .init({
              // initialize the auth2 using your credentials
              // client_id: "38103395762-a03gvbvshdtca3gkcu93hro5gajsr94e.apps.googleusercontent.com"
              client_id: "830102791057-uh6nd15bhc6laq6h21lkc1gfuu6tpdke.apps.googleusercontent.com",
            })
            .then(function onInit() {
              // on complete of init
              gapi.signin2.render("g-signin2", {
                // render the HTML button on the screen providing the ID of the element (g-signin2)
                scope: "profile email",
                width: 460,
                height: 40,
                longtitle: true,
                theme: "dark",
                onsuccess: function (googleUser) {
                  // This executes when a user successfully authorizes you to their data by clicking the button and selecting their account.
                  var profile = googleUser.getBasicProfile();
                  console.log("Dòng 708 : gapi.load -> login.js");
                  console.log("Dòng 709 : ID: " + profile.getId());
                  console.log("Dòng 710 : Name: " + profile.getName());
                  console.log("Dòng 711 : Email: " + profile.getEmail());

                  localStorage.setItem("name", profile.getEmail());
                  document.getElementById("dangnhap").innerHTML = profile.getEmail();
                  db.collection("users")
                    .where("email", "==", profile.getEmail())
                    .get()
                    .then((snapshot) => {
                      if (snapshot.docs.length != 0) {
                        // window.location.reload();
                        window.location.href = "#!trangchu";
                        localStorage.setItem("dangNhapThanhCong", "OK");

                        var a = document.getElementById("dangnhapTrangChu");
                        a.setAttribute("href", "#!trangchu");
                        // document.getElementById("dangnhap").style.visibility = "hidden";
                        var a = document.getElementById("dangnhap");
                        a.setAttribute("href", "#!suadoithongtin");

                        var b = document.getElementById("doiMatKhau");
                        b.setAttribute("href", "#!doimatkhau");

                        var c = document.getElementById("suadoithongtin");
                        c.setAttribute("href", "#!suadoithongtin");

                        var a1 = document.getElementById("hienKetQua");
                        a1.setAttribute("href", "#!ketqua");

                        snapshot.forEach(function (item) {
                          localStorage.removeItem("idHienTai");
                          localStorage.setItem("idHienTai", item.id);
                          localStorage.setItem("passwordHienTais", item.data().password);
                          localStorage.setItem("usernameHienTais", item.data().username);
                          localStorage.setItem("emailHienTais", item.data().email);
                          localStorage.setItem("fullnameHienTais", item.data().fullname);
                          localStorage.setItem("marksHienTais", item.data().marks);
                          localStorage.setItem("genderHienTais", item.data().gender);
                          localStorage.setItem("birthdayHienTais", item.data().birthday);
                          localStorage.setItem("schoolfeeHienTais", item.data().schoolfee);
                        });
                        console.log("Đăng nhập google thành công - Dòng 739");
                        if (localStorage.getItem("dangNhapThanhCong") == "OK") {
                          $rootScope.student = {};
                          $rootScope.usernameHienTai = localStorage.getItem("usernameHienTais");
                          $rootScope.passwordHienTai = localStorage.getItem("passwordHienTais");
                          $rootScope.emailHienTai = localStorage.getItem("emailHienTais");
                          $rootScope.fullnameHienTai = localStorage.getItem("fullnameHienTais");
                          $rootScope.marksHienTai = localStorage.getItem("marksHienTais");
                          $rootScope.genderHienTai = localStorage.getItem("genderHienTais");
                          $rootScope.birthdayHienTai = localStorage.getItem("birthdayHienTais");
                          $rootScope.schoolfeeHienTai = localStorage.getItem("schoolfeeHienTais");

                          // clear
                          localStorage.removeItem("usernameHienTais");
                          localStorage.removeItem("passwordHienTais");
                          localStorage.removeItem("emailHienTais");
                          localStorage.removeItem("fullnameHienTais");
                          localStorage.removeItem("marksHienTais");
                          localStorage.removeItem("genderHienTais");
                          localStorage.removeItem("birthdayHienTais");
                          localStorage.removeItem("schoolfeeHienTais");
                          localStorage.removeItem("dangNhapThanhCong");

                          $rootScope.student = {
                            username: $rootScope.usernameHienTai,
                            password: $rootScope.passwordHienTai,
                            email: $rootScope.emailHienTai,
                            fullname: $rootScope.fullnameHienTai,
                            marks: $rootScope.marksHienTai,
                            gender: $rootScope.genderHienTai,
                            birthday: $rootScope.birthdayHienTai,
                            schoolfee: $rootScope.schoolfeeHienTai,
                          };

                          console.log("Dòng 773 : " + $rootScope.student.username);
                        }
                      } else {
                        localStorage.setItem("dangNhapThanhCong", "OK");
                        db.collection("users")
                          .add({
                            username: profile.getEmail(),
                            fullname: profile.getName(),
                            password: "khongThayGiHetTron",
                            email: profile.getEmail(),
                            gender: "true",
                            schoolfee: "8650000",
                            marks: "0",
                            birthday: "13-04-1997",
                          })
                          .then(function () {
                            // window.location.reload();
                            if (localStorage.getItem("dangNhapThanhCong") == "OK") {
                              $rootScope.student = {};
                              $rootScope.usernameHienTai = localStorage.getItem("usernameHienTais");
                              $rootScope.passwordHienTai = localStorage.getItem("passwordHienTais");
                              $rootScope.emailHienTai = localStorage.getItem("emailHienTais");
                              $rootScope.fullnameHienTai = localStorage.getItem("fullnameHienTais");
                              $rootScope.marksHienTai = localStorage.getItem("marksHienTais");
                              $rootScope.genderHienTai = localStorage.getItem("genderHienTais");
                              $rootScope.birthdayHienTai = localStorage.getItem("birthdayHienTais");
                              $rootScope.schoolfeeHienTai = localStorage.getItem("schoolfeeHienTais");

                              // clear
                              localStorage.removeItem("usernameHienTais");
                              localStorage.removeItem("passwordHienTais");
                              localStorage.removeItem("emailHienTais");
                              localStorage.removeItem("fullnameHienTais");
                              localStorage.removeItem("marksHienTais");
                              localStorage.removeItem("genderHienTais");
                              localStorage.removeItem("birthdayHienTais");
                              localStorage.removeItem("schoolfeeHienTais");
                              localStorage.removeItem("dangNhapThanhCong");

                              $rootScope.student = {
                                username: $rootScope.usernameHienTai,
                                password: $rootScope.passwordHienTai,
                                email: $rootScope.emailHienTai,
                                fullname: $rootScope.fullnameHienTai,
                                marks: $rootScope.marksHienTai,
                                gender: $rootScope.genderHienTai,
                                birthday: $rootScope.birthdayHienTai,
                                schoolfee: $rootScope.schoolfeeHienTai,
                              };
                            }
                            window.location.href = "#!trangchu";
                          });
                      }
                    });
                },
              });
            });
        });
      });

      // ----------------------------------Register----------------------------------------------
      app.controller("registerCtrl", function ($rootScope, $scope) {
        $scope.register = function () {
          /*
                //---------------------------------------------------
                // var isExsist = false;
                // $scope.studentR = {};
                // if (
                //     $scope.studentR.fullname == null ||
                //     $scope.studentR.username == null ||
                //     $scope.studentR.password == null ||
                //     $scope.studentR.email == null ||
                //     $scope.studentR.birthday == null
                // ) {
                //     Swal.fire({
                //         icon: "error",
                //         title: "Oops...",
                //         text: "Đăng kí thất bại!",
                //     });
                // } else {
                //     for (var i = 0; i < $rootScope.students.length; i++) {
                //         if ($scope.studentR.username == $rootScope.students[i].username) {
                //             isExsist = true;
                //             break;
                //         }
                //     }
                //     if (!isExsist) {
                //         $rootScope.students.push(angular.copy($scope.studentR));
                //         $scope.studentR = {};
                //         Swal.fire({
                //             icon: "success",
                //             title: "NICE !",
                //             text: "Đăng kí thành công !",
                //         });
                //     } else {
                //         Swal.fire({
                //             icon: "error",
                //             title: "Oops...",
                //             text: "Tài khoản đã tồn tại ! ",
                //         });
                //     }
                // }
                //-------------------------------------------------------------
                */

          var email = $scope.studentR.email;
          var fullname = $scope.studentR.fullname;
          var password = $scope.studentR.password;
          var username = $scope.studentR.username;
          var birthday = $scope.studentR.birthday;
          var gender = $scope.studentR.gender;
          var schoolfee = $scope.studentR.schoolfee;
          var marks = "0";

          if (email == null || fullname == null || password == null) {
            alert("Vui lòng nhập thông tin không bỏ trống!!!");
            return;
          }

          db.collection("users")
            .where("email", "==", email)
            .get()
            .then((snapshot) => {
              console.log(snapshot.docs.length);
              if (snapshot.docs.length > 0) {
                console.log("Đăng kí - email đã tồn tạo - dòng 653");
                Swal.fire({
                  icon: "error",
                  title: "Oops...",
                  text: "Email này đã được đăng kí rồi !",
                  footer: '<a href="#!quenmatkhau">Bạn quên mật khẩu ?</a>',
                });
                return;
              } else {
                Swal.fire({
                  icon: "success",
                  title: "Chúc Mừng",
                  text: "Đăng Kí Thành Công !",
                });
                db.collection("users")
                  .add({
                    username: username,
                    password: password,
                    fullname: fullname,
                    email: email,
                    birthday: birthday,
                    gender: gender,
                    schoolfee: schoolfee,
                    marks: marks,
                  })
                  .then(function () {
                    window.location.href = "#!dangnhap";
                  });
              }
            });
        };
      });

      //---------------------------------ChangePassword----------------------------------------
      app.controller("changepasswordCtrl", function ($rootScope, $scope) {
        $scope.changePassword = function () {
          if ($rootScope.student.username != null) {
            if ($rootScope.student.password == $scope.studentR.password && $scope.newPassword != "") {
              // $rootScope.student.password = $scope.newPassword;
              var passwordUpdate = $scope.studentR.password == "" ? $rootScope.passwordHienTai : $scope.newPassword;
              // $rootScope.students[$rootScope.indexStudent] = angular.copy($rootScope.student);
              db.collection("users").doc(localStorage.getItem("idHienTai")).update({
                password: passwordUpdate,
              });
              Swal.fire({
                icon: "success",
                title: "NICE !",
                text: "Đổi mật khẩu thành công !",
              });

              $rootScope.student = null;
              $rootScope.indexStudent = -1;
              window.location.href = "#!dangnhap";
            } else {
              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "Đổi mật khẩu thất bại ! ",
              });
            }
          } else {
            Swal.fire({
              title: "Lỗi !!!!",
              text: "Vui lòng đăng nhập",
              icon: "warning",
              confirmButtonColor: "#3085d6",
            });
          }
        };
      });

      //---------------------------------ForgotPassword------------------------------------------
      app.controller("forgotpasswordCtrl", function ($rootScope, $scope) {
        $scope.getPass = function () {
          db.collection("users")
            .where("email", "==", $scope.email)
            .get()
            .then((snapshot) => {
              snapshot.forEach(function (doc) {
                if ($scope.email == doc.data().email && $scope.username == doc.data().username) {
                  console.log("Email db : " + doc.data().email);
                  console.log("Username db : " + doc.data().username);
                  localStorage.setItem("timThayEmailUser", "DUNG");
                  localStorage.setItem("matKhauCanLay", doc.data().password);
                  return;
                }
              });
            })
            .then(() => {
              if (localStorage.getItem("timThayEmailUser") == "DUNG") {
                /*
                      Email.send({
                        // Host: "smtp.gmail.com",
                        Host: "smtp.mailtrap.io",
                        Username: "testemailnghiatran@gmail.com",
                        Password: "a123456789A123",
                        To: $scope.email,
                        From: "testemailnghiatran@gmail.com",
                        Subject: "Lấy lại mật khẩu !",
                        Body: localStorage.getItem("matKhauCanLay"),
                      });
                      */
                Swal.fire({
                  position: "top-end",
                  icon: "success",
                  title: "Mật khẩu : " + localStorage.getItem("matKhauCanLay"),
                  showConfirmButton: false,
                  // timer: 1500,
                });
                localStorage.removeItem("matKhauCanLay");
                console.log("Lấy lại mật khẩu thành công");
                const functions = require("firebase-functions");
                const admin = require("firebase-admin");
                const nodemailer = require("nodemailer");
                const cors = require("cors")({ origin: true });
                admin.initializeApp();

                /**
                 * Here we're using Gmail to send
                 */
                let transporter = nodemailer.createTransport({
                  service: "gmail",
                  auth: {
                    user: "testemailnghiatran@gmail.com",
                    pass: "a123456789A123",
                  },
                });

                exports.sendMail = functions.https.onRequest((req, res) => {
                  cors(req, res, () => {
                    // getting dest email by query string
                    const dest = req.query.dest;

                    const mailOptions = {
                      from: "testemailnghiatran@gmail.com", // Something like: Jane Doe <janedoe@gmail.com>
                      to: $scope.email,
                      subject: "I'M A PICKLE!!!", // email subject
                      html: localStorage.getItem("matKhauCanLay")
                    };

                    // returning result
                    return transporter.sendMail(mailOptions, (erro, info) => {
                      if (erro) {
                        return res.send(erro.toString());
                      }
                      return res.send("Sended");
                    });
                  });
                });
              } else {
                Swal.fire({
                  position: "top-end",
                  icon: "error",
                  title: "Thất bại",
                  showConfirmButton: false,
                  timer: 1200,
                });
                console.log("Lấy lại mật khẩu thất bại");
                localStorage.removeItem("matKhauCanLay");
              }
            });
        };
      });

      //---------------------------------EditProfile------------------------------------------
      app.controller("updateaccountCtrl", function ($rootScope, $scope) {
        $scope.update = function () {
          //   $rootScope.students[$rootScope.indexStudent] = angular.copy(
          //     $rootScope.student
          //   );
          //-------------------------------
          console.log("update");
          console.log("Fullname : " + $scope.student.fullname);
          console.log("Fullname other : " + $rootScope.fullnameHienTai);

          var fullnameUpdate = $scope.student.fullname == "" ? $rootScope.fullnameHienTai : $scope.student.fullname;
          var passwordUpdate = $scope.student.password == "" ? $rootScope.passwordHienTai : $scope.student.password;
          var genderUpdate = $scope.student.gender;
          var birthDayUpdate = $scope.student.birthday == "" ? $rootScope.birthdayHienTai : $scope.student.birthday;
          var schoolfeeUpdate = $scope.student.schoolfee == "" ? $rootScope.schoolfeeHienTai : $scope.student.schoolfee;

          db.collection("users").doc(localStorage.getItem("idHienTai")).update({
            fullname: fullnameUpdate,
            password: passwordUpdate,
            gender: genderUpdate,
            birthday: birthDayUpdate,
            schoolfee: schoolfeeUpdate,
          });

          $rootScope.student.fullname = fullnameUpdate;
          $rootScope.student.password = passwordUpdate;
          $rootScope.student.gender = genderUpdate;
          $rootScope.student.birthday = birthDayUpdate;
          $rootScope.student.schoolfee = schoolfeeUpdate;
          Swal.fire({
            icon: "success",
            title: "NICE !",
            text: "Cập nhật thành công !",
          });
          //-------------------------------------------
          window.location.href = "#!suadoithongtin";
        };

        // ---- end ----
      });

      //------------------------------CLOCK--------------------------------------
      var upgradeTime = 900;
      var seconds = upgradeTime;
      function timer() {
        var days = Math.floor(seconds / 24 / 60 / 60);
        var hoursLeft = Math.floor(seconds - days * 86400);
        var hours = Math.floor(hoursLeft / 3600);
        var minutesLeft = Math.floor(hoursLeft - hours * 3600);
        var minutes = Math.floor(minutesLeft / 60);
        var remainingSeconds = seconds % 60;
        function pad(n) {
          return n < 10 ? "0" + n : n;
        }
        document.getElementById("countdown").innerHTML = pad(minutes) + ":" + pad(remainingSeconds);
        if (seconds == 0) {
          clearInterval(countdownTimer);
          document.getElementById("countdown").innerHTML = "Completed";
        } else {
          seconds--;
        }
      }
      var countdownTimer = setInterval("timer()", 1000);

      // ---------------------------------EXAM-----------------------------------------------
      app.controller("tnctrl", function ($scope, $http, $routeParams, $rootScope) {
        $scope.caccauhoi = [];
        $scope.idMH = $routeParams.idMH;
        $scope.tenMH = $routeParams.tenMH;
        $scope.soCauHoi = 0;
        $scope.random10CauHoi = [];
        $scope.mangIdCauHoi = [];
        $rootScope.fullCauHoi = [];
        var setRandom10CauHoi = new Set();
        $http.get("db/Quizs/" + $scope.idMH + ".js").then(
          function (d) {
            $rootScope.fullCauHoi = d.data;
            $scope.caccauhoi = d.data;
            $scope.soCauHoi = $scope.caccauhoi.length - 1;
            /*
                  for (let i = 0; i < 10; i++) {
                    var rand = Math.floor(Math.random() * $scope.soCauHoi);
                    $scope.random10CauHoi[i] = angular.copy($scope.caccauhoi[rand]);
                    $scope.mangIdCauHoi[i] = angular.copy(rand);
                  }
                  */
            // -- random không trùng
            for (let i = 0; i <= $scope.soCauHoi; i++) {
              if (setRandom10CauHoi.size == 10) break;
              var rand = Math.floor(Math.random() * $scope.soCauHoi);
              setRandom10CauHoi.add(rand);
            }
            var itr = setRandom10CauHoi.values();
            // -- lấy random 10 câu hỏi
            for (let i1 = 0; i1 < setRandom10CauHoi.size; i1++) {
              var getValueRanDom = itr.next().value;
              $scope.random10CauHoi[i1] = angular.copy($scope.caccauhoi[getValueRanDom]);
              $scope.mangIdCauHoi[i1] = angular.copy(getValueRanDom);
            }
          },
          function (e) {
            alert("Lỗi : " + e.statusText);
          }
        );

        $scope.pageSize = 1;
        $scope.start = 0;
        // chuyển trang
        $scope.next = function () {
          if ($scope.start < $scope.random10CauHoi.length - $scope.pageSize) {
            $scope.start += $scope.pageSize;
          }
        };

        $scope.prev = function () {
          if ($scope.start > 0) {
            $scope.start -= $scope.pageSize;
          }
        };
        // -------------- test ----------------------------------
        /*
              var cauHoi_dapAn_traLoi = new Array();
              cauHoi_dapAn_traLoi[0] = new Array(); // câu hỏi
              cauHoi_dapAn_traLoi[1] = new Array(); // đáp án
              cauHoi_dapAn_traLoi[2] = new Array(); // trả lời

              for (var c1 = 0; c1 < $scope.random10CauHoi.length; c1++) {
                cauHoi_dapAn_traLoi[0].push($scope.random10CauHoi[c1].Id); // thêm câu hỏi
                console.log("->>" + $scope.random10CauHoi[c1].Id + " <----");
                cauHoi_dapAn_traLoi[1].push($scope.random10CauHoi[c1].AnswerId); // thêm câu trả lời
              }

              var mapCauHoi_UserChon = new Map();
              $scope.ans = function (cauTraLoi, IdCauHoi) {
                console.log(">>--------------------<<");
                console.log("Id câu hỏi : " + IdCauHoi); // Id câu hỏi
                console.log("Ngươi dùng chọn đáp án : " + cauTraLoi); //  người dùng chọn đáp án
                mapCauHoi_UserChon.set(IdCauHoi, cauTraLoi);
              };
              $scope.ketThucKiemTra = function () {
                var diemTrungBinh = 0;
                for (let [key, value] of mapCauHoi_UserChon) {
                  // console.log(`${key} has ${value}`);
                  cauHoi_dapAn_traLoi[2].push(value);
                }
                for (var checkAns = 0; checkAns < 10; checkAns++) {
                  if (cauHoi_dapAn_traLoi[1][checkAns] == cauHoi_dapAn_traLoi[2][checkAns]) {
                    console.log(">--" + cauHoi_dapAn_traLoi[1][checkAns] + " == " + cauHoi_dapAn_traLoi[2][checkAns]);
                    diemTrungBinh++;
                  }
                }
                console.log( cauHoi_dapAn_traLoi[0][0]);
                console.log( cauHoi_dapAn_traLoi[2][0]);
                console.log( cauHoi_dapAn_traLoi[1][0]);
                console.log("Điểm trung bình : " + diemTrungBinh);
              };
              */
        //---------------Hết test-------------------
        // ----------------------------------- Lấy câu trả lời từ người dùng

        var mapCauHoi_CauTraLoi = new Map();
        var mapCauHoi_UserChon = new Map();

        $scope.ans = function (cauTraLoi, IdCauHoi) {
          console.log(">>--------------------<<");
          console.log("Id câu hỏi : " + IdCauHoi); // Id câu hỏi
          console.log("Ngươi dùng chọn đáp án : " + cauTraLoi); //  người dùng chọn đáp án
          mapCauHoi_UserChon.set(IdCauHoi, cauTraLoi);
        };

        $scope.ketThucKiemTra = function () {
          for (var cs = 0; cs < $scope.random10CauHoi.length; cs++) {
            mapCauHoi_CauTraLoi.set($scope.random10CauHoi[cs].Id, $scope.random10CauHoi[cs].AnswerId);
            // mapCauHoi_UserChon.set($scope.random10CauHoi[cs].Id, "No");
          }
          console.log("-----------------------------------");
          var diem = 0;
          var dapAn = [];
          var traLoi = [];
          var idCauHoiDB = [];
          for (let [key, value] of mapCauHoi_UserChon) {
            // console.log(">>-------BBB---------<<");
            // console.log(`${key} has ${value}`);
            traLoi.push(value);
          }

          for (let [key, value] of mapCauHoi_CauTraLoi) {
            // console.log(">>-------AAA---------<<");
            // console.log(`${key} has ${value}`);
            idCauHoiDB.push(key);
            dapAn.push(value);
          }

          for (var o = 0; o < dapAn.length; o++) {
            if (dapAn[o] == traLoi[o]) {
              diem++;
            }
          }
          console.log("Điểm : " + diem);

          var tenMonHoc = $routeParams.idMH;
          var thoiGianKetThuc = new Date().getTime();
          // lưu
          db.collection("KetQuaKiemTra").add({
            idKetQuaKiemTra: $rootScope.student.username + " - " + thoiGianKetThuc,
            subjects: tenMonHoc,
            email: $rootScope.student.email,
            username: $rootScope.student.username,
            marks: diem,
          });

          db.collection("ChiTietKetQuaKiemTra").add({
            idKetQuaKiemTra: $rootScope.student.username + " - " + thoiGianKetThuc,
            CauHoi: idCauHoiDB,
            CauTraLoi: traLoi,
            DapAn: dapAn,
            // subjects: tenMonHoc,
          });
          //------------------------

          //----- END----
          window.location.href = "#!ketqua";
        };
        if (seconds == 0) {
          clearInterval(countdownTimer);
          document.getElementById("countdown").innerHTML = "Completed";
          $scope.ketThucKiemTra();
        }
        //----
      });
      //---- hết phần trắc nghiệm

      //------------------------------- RESULT -----------------------------------
      app.controller("ketquaController", function ($scope, $routeParams, $rootScope) {
        if ($rootScope.student.username != null) {
          $rootScope.lstKetQua = [];
          function addItemToList(tenMonHoc, diem, chiTiet) {
            $scope.ketQua = {
              tenMonHoc: tenMonHoc,
              diem: diem,
              chiTiet: chiTiet,
            };
            $rootScope.lstKetQua.push($scope.ketQua);
          }
          // function FetchAllData() {
          db.collection("KetQuaKiemTra")
            .where("username", "==", $rootScope.student.username)
            .get()
            .then((snapshot) => {
              snapshot.forEach(function (item) {
                addItemToList(item.data().subjects, item.data().marks, item.data().idKetQuaKiemTra);
              });
              $rootScope.$apply();
            });
          // }
          // FetchAllData();
        } else {
          Swal.fire({
            icon: "error",
            title: "Oops...",
            html: '<h2 class="text-danger"> Vui lòng đăng nhâp để xem kết quả ! </h2>',
            width: 750,
            padding: "3em",
            background: "#fff url(https://sweetalert2.github.io/images/trees.png)",
            backdrop: `
                              rgba(0,0,123,0.4)
                              url("https://sweetalert2.github.io/images/nyan-cat.gif")
                              left top
                              no-repeat
                            `,
          }).then(function () {
            window.location.href = "#!dangnhap";
          });
        }
        //-------END----
      });

      //--------------------------------- DETAILS ------------------------------------
      app.controller("chiTietController", function ($scope, $routeParams, $http, $rootScope, $timeout) {
        var tenMonHoc = $routeParams.idMH;
        $scope.listcauhoi = [];
        $scope.listDapAn = [];
        $scope.listCauTraLoi = [];
        $scope.mangInRaCauHoi = [];
        $scope.mangInRaCauTraLoi = [];
        $scope.lstKetQuaChon = [];
        $http
          .get("db/Quizs/" + tenMonHoc + ".js")
          .then(function (d) {
            $rootScope.fullCauHoi_duocChon = d.data;
          })
          .then(function () {
            db.collection("ChiTietKetQuaKiemTra")
              .where("idKetQuaKiemTra", "==", $routeParams.idKetQuaKiemTra)
              .get()
              .then((snapshot) => {
                snapshot.forEach(function (item) {
                  $scope.listcauhoi.push(item.data().CauHoi); // mảng
                  $scope.listCauTraLoi.push(item.data().CauTraLoi); // mảng
                  $scope.listDapAn.push(item.data().DapAn); // mảng
                });
                $scope.$apply();
              })
              .then(function () {
                for (var l = 0; l < 10; l++) {
                  for (var k = 0; k < $scope.fullCauHoi_duocChon.length; k++) {
                    if ($scope.listcauhoi["0"][l] == $rootScope.fullCauHoi_duocChon[k].Id) {
                      $scope.mangInRaCauHoi.push($rootScope.fullCauHoi_duocChon[k]);
                    }
                  }
                }
                $scope.$apply();
                for (var k = 0; k < $scope.mangInRaCauHoi.length; k++) {
                  for (var o = 0; o < $scope.mangInRaCauHoi[k].Answers.length; o++) {
                    if ($scope.listCauTraLoi["0"][k] == $scope.mangInRaCauHoi[k].Answers[o].Id) {
                      $scope.lstKetQuaChon.push($scope.mangInRaCauHoi[k].Answers[o].Text);
                    }
                  }
                }
                $scope.$apply();
                console.log($scope.lstKetQuaChon[0]);
              });
          });

        $scope.pageSize = 1;
        $scope.start = 0;
        $scope.next = function () {
          if ($scope.start < $scope.mangInRaCauHoi.length - $scope.pageSize) {
            $scope.start += $scope.pageSize;
          }
        };
        $scope.prev = function () {
          if ($scope.start > 0) {
            $scope.start -= $scope.pageSize;
          }
        };

        //---------------------- end--------------
      });
      //-----------------------------END GAME--------------------------------
    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
  </body>
</html>
